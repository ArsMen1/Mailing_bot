from random import choice
from re import search, match
from mailing_bot.shp_mailing_bot.config import RESPONSIBLE_FOR_THE_BOT, GRADE_INFO_STATE_LINK
from tabulate import tabulate
from mailing_bot.logger_bot import logger

are_you_really_prep_message = 'ĞĞµ Ğ¼Ğ¾Ğ³Ñƒ Ğ²Ğ°Ñ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ² Ğ¼Ğ¾ĞµĞ¹ Ñ‚ĞµÑ‚Ñ€Ğ°Ğ´Ğ¾Ñ‡ĞºĞµ, Ğ²Ñ‹ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¿Ñ€ĞµĞ¿Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ? ğŸ¥¸\n' \
                              f'Ğ•ÑĞ»Ğ¸ Ğ´Ğ°, Ñ‚Ğ¾ ÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾ ÑÑ‚Ğ¾ Ğ¼Ğ¾ĞµĞ¹ Ğ¼Ğ°Ğ¼Ğ¾Ñ‡ĞºĞµ {RESPONSIBLE_FOR_THE_BOT}, ' \
                              f'Ğ¾Ğ½Ğ° Ğ²Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ ĞºĞ°Ñ€Ğ°Ğ½Ğ´Ğ°ÑˆĞ¾Ğ¼.'


# def ok_message() -> str:
#     ok_phrases = (
#         'ĞĞº',
#         'ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ¾',
#         'Ğ’ÑÑ‘ ÑÑĞ½Ğ¾',
#         'Ğ’Ğ¾ÑĞ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¾',
#         'ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾ Ğ²ÑÑ‘',
#         'ĞĞ³Ğ°, Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾',
#         'ĞĞº, ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾',
#         'ĞĞ±Ñ‰ĞµĞ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾',
#         'Ğ¡Ñ…Ğ²Ğ°Ñ‡ĞµĞ½Ğ¾',
#         'ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ¾',
#         'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾',
#         'Ğ¨ĞŸĞ°ÑĞ¸Ğ±Ğ¾, Ğ²ÑÑ‘ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾'
#     )
#
#     return choice(ok_phrases)


def kd_link_message() -> str:
    db_phrases = (
        'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°.',
        'ĞĞ¹! ĞšĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ñ‹ Ğ½Ğ° Ğ¾Ğ´Ğ½Ñƒ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºÑƒÑ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ° ğŸ¤“',
        'Ğ‘Ğ°Ğ·Ğ° Ğ—Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ¾Ğ±Ğ¸Ñ‚Ğ°ĞµÑ‚ Ñ‚ÑƒÑ‚: ',
        'Ğ’Ğ¾Ñ‚ ÑÑÑ‹Ğ»Ğ¾Ñ‡ĞºĞ°. Ğ˜ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ñ‚ĞµÑ€ÑĞ¹Ñ‚Ğµ ğŸ™ƒ',
        'Ğ’Ğ¾Ñ‚ Ğ¶Ğµ Ğ¾Ğ½Ğ°!',
        'ĞĞ°Ğ´ĞµÑÑÑŒ, Ğ²Ñ‹ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ Ğ² Ñ…Ñ€Ğ°Ğ¼ Ñ†ĞµĞ½Ğ½ĞµĞ¹ÑˆĞ¸Ñ… Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ¨ĞŸ. Ğ’ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞµĞ±Ñ Ñ‚Ğ¸Ñ…Ğ¾ ğŸ¤«',
        'ĞŸĞ¾Ñ‚ĞµÑ€ÑĞ»Ğ¸ Ğ‘Ğ°Ğ·Ñƒ Ğ—Ğ½Ğ°Ğ½Ğ¸Ğ¹? Ğ›Ğ°Ğ°Ğ´Ğ½Ğ¾, Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚Ğµ ğŸ˜Œ',
        'Ğ—Ğ½Ğ°ĞºĞ¾Ğ¼ÑŒÑ‚ĞµÑÑŒ, Ğ½Ğ°ÑˆĞ° Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾ ÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ğ°Ñ Ğ‘Ğ°Ğ·Ğ° Ğ—Ğ½Ğ°Ğ½ÑŒĞµĞ²Ğ½Ğ° Ğ¨ĞŸĞ²Ğ¾Ğ²Ğ½Ğ° ',
        'Ğ’Ğ¾Ñ‚, Ğ½Ğµ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ¸Ñ‚Ğµ',
        'Ğ’Ğ¾Ñ‚ Ğ¾Ğ½, Ğ½Ğ°Ñˆ ÑĞ²ÑĞ¾Ğ¹ Ğ³Ñ€Ğ°Ğ°Ğ»ÑŒ, Ğ¾Ğ±Ñ€Ğ°Ñ‰Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ñ Ğ½Ğ¸Ğ¼ Ğ±ĞµÑ€ĞµĞ¶Ğ½Ğ¾'
    )

    return choice(db_phrases)


def evaluation_indicator_message(grade: int = None) -> str:  # get comment for nps or retirement
    if not grade:
        logger.info("No grade")
        return ""

    # phrases
    grade_3_indicators_comment = (
        'ĞšĞ°Ğ¹Ñ„ :)',
        'ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ğŸ¤©',
        'Ğ’Ğ°Ñƒ Ğ²Ğ°Ñƒ ğŸ˜€',
        'Ğ’Ğ°Ñ Ñ‚Ğ°Ğº Ğ»ÑĞ±ÑÑ‚ ÑƒÑ‡ĞµĞ½Ğ¸ĞºĞ¸ ğŸ¥°',
        'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸ ğŸ˜Œ',
        'ĞĞ³Ğ¾-Ğ³Ğ¾, Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾ :)',
        'Ğ—Ğ°Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸ â˜ºï¸',
        'Ğ’Ñ‹ÑÑˆĞ¸Ğ¹ Ğ¿Ğ¸Ğ»Ğ¾Ñ‚Ğ°Ğ¶ âœˆï¸',
        'ĞĞ¸Ñ‡ĞµĞ³Ğ¾ ÑĞµĞ±Ğµ, Ğ²Ğ¾Ñ‚ ÑÑ‚Ğ¾ ĞºĞ»Ğ°ÑÑ!',
        'ĞĞ¹, Ğ¸Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¸Ñ‚Ğµ, Ñ Ñ‡Ñ‚Ğ¾, Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ°Ñ€Ğ¸Ğ²Ğ°Ñ Ñ Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ñ‹Ğ¼ Ğ»ÑĞ±Ğ¸Ğ¼Ñ†ĞµĞ¼??',
        'Ğ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ğ°Ñˆ Ğ°Ğ²Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„?)',
        'Ğ­Ñ‚Ğ¾ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾ ÑƒÑĞ¿ĞµÑ… ğŸ˜',
        'ĞĞ±Ñ€Ğ°Ğ·Ñ†Ğ¾Ğ²Ğ¾-Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚)',
        'Ğ®Ñ…ÑƒÑƒ ğŸ¤ ',
        'Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ¾...',
        'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹Ñ‚Ğµ Ğ² Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ Ğ´ÑƒÑ…Ğµ ğŸ™‚',
        'Ğ—Ğ° Ğ²Ğ°Ğ¼Ğ¸ ÑƒĞ¶Ğµ Ğ²Ñ‹ĞµÑ…Ğ°Ğ»Ğ° Ğ¿Ğ¾Ğ»Ğ¸Ñ†Ğ¸Ñ Ğ·Ğ° Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞµÑÑ‚Ğ¸!!!',
        'Ğ—Ğ½Ğ°ĞµÑ‚Ğµ, Ñ Ñ…Ğ¾Ñ‚ĞµĞ» Ğ±Ñ‹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¼ĞµĞ½Ñ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°Ğº ĞºÑ‚Ğ¾-Ğ½Ğ¸Ğ±ÑƒĞ´ÑŒ Ğ»ÑĞ±Ğ¸Ğ» ĞºĞ°Ğº Ğ²Ğ°Ñ Ğ»ÑĞ±ÑÑ‚ Ğ´ĞµÑ‚Ğ¸ ğŸ¥º'
    )

    grade_2_indicators_comment = (
        'Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸ â˜ºï¸',
        'ĞĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾!',
        'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾Ğ¾Ğ¾',
        'Ğ§ÑƒĞ´ĞµÑĞ½Ğ¾!',
        'ĞĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ğŸ™‚',
        'Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸, Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾)',
        'ĞÑ‡ĞµĞ½ÑŒ Ğ½ĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾. Ğ”Ğ°Ğ»ÑŒÑˆĞµ â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ğŸ’ª',
        'Ğ—Ğ°Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!',
        'Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!',
        "ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°!",
        'Ğ’Ğ°Ñƒ, ĞºÑ€ÑƒÑ‚Ğ¾ ğŸ˜„',
        "Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ¾..."
    )

    grade_1_indicators_comment = (
        "ĞĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾! Ğ”Ğ°Ğ»ÑŒÑˆĞµ â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ğŸ’ª",
        "ĞĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ :)",
        "Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸. ĞĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾!",
        "Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°)",
        "ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾ Ğ·Ğ´ĞµÑÑŒ Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ¾ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ°!"
    )

    grade_0_indicators_comment = (
        'ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ¸ÑĞºĞ°Ñ‚ÑŒ ĞµÑ‰Ñ‘ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğº Ñ€ĞµĞ±ÑÑ‚Ğ°Ğ¼. ĞĞµĞ¿Ğ¾Ğ±ĞµĞ´Ğ¸Ğ¼Ñ‹Ñ… Ğ½Ğµ Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚ ğŸ’ª',
        'Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğ·Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ :)',
        'Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ, Ğ²Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ»ÑĞ±Ğ¾Ğ¼Ñƒ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºÑƒ Ğ’Ğ£Ğ¦ ğŸ™‚',
        "ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ğ¾ Ğ·Ğ´ĞµÑÑŒ Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ¾ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ° ğŸ˜„"
    )

    comments_grade = (
        grade_0_indicators_comment, grade_1_indicators_comment, grade_2_indicators_comment, grade_3_indicators_comment)

    return choice(comments_grade[grade])


def get_name_patronymic(name: str):
    name = name.split()
    if len(name) == 3 or len(name) == 4:  # 4 -- could be maiden name
        return " ".join(name[-2:])
    elif len(name) == 2:
        return name[-1]


def indicators_message(nps: str,
                       retirement: str,
                       average_nps: str,
                       average_retirement: str,
                       redflags: str,
                       actual_sem_flag: bool = False) -> tuple:
    """
    Returns a message and an indicators flag (are there indicators or not)
    """

    if not nps and not retirement:
        return 'ĞĞ¹, Ğ½Ğµ Ğ¼Ğ¾Ğ³Ñƒ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ²Ğ°ÑˆĞ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸ ğŸ‘‰ğŸ»ğŸ‘ˆğŸ»\n\n' \
               'Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¿Ñ€ĞµĞ¿Ğ¾Ğ´Ğ°Ñ‘Ñ‚Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ÑĞµĞ¼ĞµÑÑ‚Ñ€, Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚ĞµÑÑŒ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ ÑĞµĞ¼ĞµÑÑ‚Ñ€Ğ°. ' \
               'Ğ’Ğ°ÑˆĞ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒÑÑ‚ÑÑ\n\n' \
               f'Ğ’ Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº {RESPONSIBLE_FOR_THE_BOT}.', \
               False  # indicators flag

    # nps_comment = ""
    # retirement_comment = ""
    #
    # if actual_sem_flag:
    #     nps_comment = f'ğŸ’­ `{evaluation_indicator_message(nps=nps)}`'
    #     retirement_comment = f'ğŸ’­ `{evaluation_indicator_message(retirement=retirement)}`'

    message = f'ğŸ“Œ *ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸*'

    if nps:
        message += f'\n\n' \
                   f'*Ğ’Ğ°Ñˆ NPS â€” {nps}%.*\n' \
                   f'Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ NPS Ğ¿Ğ¾ ÑˆĞºĞ¾Ğ»Ğµ â€” {average_nps}%.\n'
    else:
        message += '\n\n' \
                   'Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ²Ğ°ÑˆĞµĞ¼Ñƒ NPS Ñ Ğ½Ğµ Ğ½Ğ°ÑˆÑ‘Ğ» Ğ² ÑĞ²Ğ¾ĞµĞ¹ ĞºĞ½Ğ¸Ğ¶ĞµÑ‡ĞºĞµ ğŸ§\n' \
                   f'Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº  {RESPONSIBLE_FOR_THE_BOT}'

    if retirement:
        message += f'\n\n' \
                   f'*Ğ’Ğ°ÑˆĞ° Ğ²Ñ‹Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ â€” {retirement}%.*\n' \
                   f'Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ²Ñ‹Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾ ÑˆĞºĞ¾Ğ»Ğµ â€” {average_retirement}%.\n'
    else:
        message += '\n\n' \
                   'Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ²Ğ°ÑˆĞµĞ¹ Ğ²Ñ‹Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸ Ñ Ğ½Ğµ Ğ½Ğ°ÑˆÑ‘Ğ» Ğ² ÑĞ²Ğ¾ĞµĞ¹ ĞºĞ½Ğ¸Ğ¶ĞµÑ‡ĞºĞµ ğŸ§\n' \
                   f'Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº  {RESPONSIBLE_FOR_THE_BOT}'

    if redflags:
        message += f'\n\n*ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€ĞµĞ´Ñ„Ğ»Ğ°Ğ³Ğ¾Ğ² â€” *{redflags}.\n'

    return message, True


def current_group_detailing_nps_message(info):
    if not info:
        return ""

    result = f"\n\n\nğŸ“Œ *Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼*\n\n"

    info = info.split("\n")
    table = []
    for s in info:
        item = s.split("\t")
        # logger.debug(item)
        curse = match(r"[Ğ-Ğ¯Ğ°-ÑĞÑ‘A-Za-z/+\-]+", item[0])
        if not curse:
            return ""
        # group = search(r"_?\w\d{3}", item[0])
        group = item[0].split("-")
        if not group:
            pass
        item[0] = curse[0] + "-" + group[-2]
        table.append(item)
    result = result + "`" + tabulate(table, headers=["Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ°", "NPS"]) + "`"

    return result


grade_3_emoji = "ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜€ğŸ¥°ğŸ˜ğŸ¤ "
grade_2_emoji = "ğŸ™‚ğŸ™ƒğŸ˜ŠğŸ˜ŒğŸ¤—ğŸ˜‰"
grade_1_emoji = "ğŸ¤¨ğŸ¥¸ğŸ§ğŸ˜¶ğŸ¤”ğŸ™„"
grade_0_emoji = "ğŸ˜”ğŸ˜’ğŸ˜•ğŸ™ğŸ˜“ğŸ˜¶ğŸ˜µâ€ğŸ’«"
grade_emoji = (grade_0_emoji, grade_1_emoji, grade_2_emoji, grade_3_emoji)


def grade_info_message(info, actual_sem=False):
    if not info:
        return ""
    result = "\n\n*Ğ’Ğ°Ñˆ Ğ³Ñ€ĞµĞ¹Ğ´ â€”  "
    grade = info[0]
    result += grade + ".*"
    if actual_sem:
        result += f"\n" \
                  f"ğŸ’­ `{evaluation_indicator_message(grade=int(grade))}`"
        result += f"\n[Ğ¡Ñ‚Ğ°Ñ‚ÑŒÑ Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ğ³Ñ€ĞµĞ¹Ğ´Ğ° Ğ¸ NPS]" \
                  f"({GRADE_INFO_STATE_LINK})."
    return result
